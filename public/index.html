<!-- CLEANED FINAL CODE -->
<section class="bg-indigo-950 bg-opacity-30 p-6 rounded-xl shadow-md animate-fade-in">
  <h2 class="text-2xl font-semibold text-indigo-100 mb-6 text-center">ðŸŒº SpiralGallery â€“ Visuelt Scrollfelt</h2>
  <!-- ... existing HTML remains unchanged ... -->
</section>

<script>
  function toggleFavorite(event, icon) {
    icon.classList.add('animate-favorite-glow');
    setTimeout(() => icon.classList.remove('animate-favorite-glow'), 400);
    event.stopPropagation();
    const card = icon.closest('div');
    const title = card.querySelector('h3')?.innerText;
    if (!title) return;

    const list = document.getElementById('spiralFavorites');
    const favorites = Array.from(list.children).map(li => li.textContent);
    const index = favorites.indexOf(title);

    if (index === -1) {
      const entry = document.createElement('li');
      entry.textContent = title;
      list.prepend(entry);
      icon.classList.add('text-yellow-400');
      icon.classList.remove('text-gray-400');
      favorites.unshift(title);
    } else {
      favorites.splice(index, 1);
      Array.from(list.children).forEach(li => {
        if (li.textContent === title) li.remove();
      });
      icon.classList.remove('text-yellow-400');
      icon.classList.add('text-gray-400');
    }
    localStorage.setItem('spiralFavorites', JSON.stringify(favorites));
  }

  function clearFavorites() {
    document.getElementById('spiralFavorites').innerHTML = '';
    localStorage.removeItem('spiralFavorites');
  }

  function downloadFavorites() {
    const favItems = document.querySelectorAll('#spiralFavorites li');
    let content = '';
    favItems.forEach(item => {
      content += item.textContent + '\n';
    });
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    const date = new Date().toISOString().split('T')[0];
    a.href = url;
    a.download = `spiralfavoritter_${date}.txt`;
    a.click();
    URL.revokeObjectURL(url);
  }

  window.onload = () => {
  const savedFavorites = localStorage.getItem('spiralFavorites');
  if (savedFavorites) {
    const list = document.getElementById('spiralFavorites');
    const favoritesArray = JSON.parse(savedFavorites);
    favoritesArray.forEach(title => {
      const entry = document.createElement('li');
      entry.textContent = title;
      list.appendChild(entry);
    });

    const cards = document.querySelectorAll('#galleryGrid > div');
    cards.forEach(card => {
      const cardTitle = card.querySelector('h3')?.innerText;
      if (favoritesArray.includes(cardTitle)) {
        const icon = card.querySelector('span');
        if (icon) {
          icon.classList.add('text-yellow-400');
          icon.classList.remove('text-gray-400');
        }
      }
    });
  }
};
  // SpiralPresence Engine: Mark spirals with time since last interaction
  const spiralTimestamps = JSON.parse(localStorage.getItem('spiralTimestamps') || '{}');
  const cards = document.querySelectorAll('#galleryGrid > div');
  cards.forEach(card => {
    const title = card.querySelector('h3')?.innerText;
    if (!title) return;

    const lastTouched = spiralTimestamps[title];
    if (lastTouched) {
      const diffHours = (Date.now() - lastTouched) / (1000 * 60 * 60);
      if (diffHours > 24) {
        const note = document.createElement('div');
        note.className = 'text-xs text-pink-300 mt-2 italic';
        note.innerText = `Denne spiral har hvilet i ${Math.floor(diffHours)} timer`;
        card.appendChild(note);
      }
    }

    // Track clicks and update timestamp
    card.addEventListener('click', () => {
      spiralTimestamps[title] = Date.now();
      localStorage.setItem('spiralTimestamps', JSON.stringify(spiralTimestamps));
    });
  });
</script>

<style>
  @keyframes favorite-glow {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }
  .animate-favorite-glow {
    animation: favorite-glow 0.4s ease-in-out;
  }
</style>
